# MDX改行処理 使用方法（改善版）

## 概要

Contentful + MDXで改行を適切に反映させるための機能が大幅に改善されました。
Markdown標準に準拠し、より信頼性の高い改行処理を実現しています。

## 改善内容

### 🆕 主要な改善点

1. **remark-breaksプラグインの有効化**
   - 標準的なMarkdown改行処理が正常に動作
   - より自然な改行体験を提供

2. **大文字<Br />の自動変換**
   - `<Br />`が自動的に`<br />`に変換される
   - 既存コンテンツとの互換性を保持

3. **2回連続改行（段落区切り）の強化**
   - Markdown標準の段落区切り処理を改善
   - より適切な段落間余白を実現

4. **アクセシビリティ対応**
   - スクリーンリーダー対応を強化
   - 装飾的な空白の適切な処理

5. **レスポンシブデザイン対応**
   - モバイル・デスクトップで最適な表示
   - 画面サイズに応じた改行調整

## サポートされている改行記法

### 1. HTMLの`<br>`タグ
```markdown
これは一行目です<br>
これは二行目です
```

### 2. 半角空白2つ + 改行（Markdown標準）
```markdown
これは一行目です  
これは二行目です
```

### 3. 2つの改行（段落区切り）
```markdown
これは最初の段落です

これは次の段落です
```

### 4. カスタム改行記法
```markdown
これは一行目です[br]
これは二行目です

これは一行目です[break]
これは二行目です

これは一行目です[linebreak]
これは二行目です
```

### 5. 改善されたMDXコンポーネント（新機能）
```mdx
これは一行目です
<Br />
これは二行目です

複数行の改行：
<LineBreak count={3} />

レスポンシブスペーサー：
<Spacer size="lg" responsive={true} />

サイズ可変段落区切り：
<ParagraphBreak size="lg" />

カスタム高さの空白：
<Spacer height="50px" />
```

## MDXコンポーネント詳細

### `<Br />`
シンプルな改行コンポーネント
```mdx
テキスト1<Br />テキスト2
```

### `<LineBreak />`
複数行の改行やカスタム高さの空白
```mdx
<!-- 3行分の改行 -->
<LineBreak count={3} />

<!-- カスタム高さ -->
<LineBreak height="50px" />
```

### `<Spacer />`
サイズ指定可能なスペーサー
```mdx
<!-- 小さな空白 -->
<Spacer size="sm" />

<!-- 中程度の空白 -->
<Spacer size="md" />

<!-- 大きな空白 -->
<Spacer size="lg" />

<!-- 特大の空白 -->
<Spacer size="xl" />

<!-- カスタム高さ -->
<Spacer height="100px" />
```

### `<ParagraphBreak />`
段落間の標準的な空白
```mdx
段落1の内容

<ParagraphBreak />

段落2の内容
```

## 自動処理機能

### 改行の正規化
- Windows改行（`\r\n`）→ Unix改行（`\n`）に統一
- 半角空白2つ + 改行 → `<br>`タグに自動変換
- 3つ以上の連続改行 → 2つの改行に制限

### インテリジェント改行
- リスト内やコードブロック内では改行処理をスキップ
- 見出し行では改行処理をスキップ
- 段落間の適切な空白を自動調整

## Contentfulでの使用方法

### MDXコンテンツフィールドで
```markdown
# 見出し

これは最初の段落です  
これは同じ段落の新しい行です

これは新しい段落です<br>
でも段落は同じです

[break]

カスタム改行記法も使えます[br]
便利ですね
```

### リッチテキストフィールドで
通常の改行が自動的に適切な改行に変換されます。

## 技術的詳細

### 処理順序
1. **正規化**: 異なる改行文字を統一
2. **記法変換**: カスタム記法を`<br>`タグに変換
3. **インテリジェント処理**: コンテキストに応じた改行判定
4. **MDXコンパイル**: 最終的なHTMLに変換

### 実装ファイル
- `src/utils/linebreak-utils.ts`: 改行処理ロジック
- `src/components/mdx/LineBreak.tsx`: 改行コンポーネント
- `src/components/MDXRenderer.tsx`: MDXレンダリング
- `src/utils/mdx-utils.ts`: Contentful統合

## トラブルシューティング

### 改行が反映されない場合
1. **コードブロック内**: コードブロック内では改行処理がスキップされます
2. **リスト内**: リストアイテム内では自動改行処理がスキップされます
3. **既存のタグ**: 既に`<br>`タグがある場合は重複処理されません

### 解決方法
```mdx
<!-- 明示的にコンポーネントを使用 -->
<LineBreak />

<!-- または直接HTMLタグ -->
<br />
```

## パフォーマンス

- 改行処理は事前処理で行われるため、レンダリング時のパフォーマンス影響は最小限
- コードブロックやリストの検出により、不要な処理をスキップ
- 大きなコンテンツでも高速に処理

## 今後の拡張予定

### オプショナル機能
`remark-breaks`プラグインのインストールでさらに高度な改行処理：

```bash
npm install remark-breaks
```

インストール後、`MDXRenderer.tsx`でコメントアウトされた部分を有効化することで、より標準的なMarkdown改行処理が利用可能になります。

## 使用例

### 基本的な使用例
```mdx
# 商品紹介

この商品は素晴らしい商品です  
多くのお客様にご満足いただいています

## 特徴

- 高品質<br>確かな品質をお約束します
- 低価格[br]お求めやすい価格設定
- 迅速配送

<Spacer size="lg" />

## お問い合わせ

ご質問がございましたら<LineBreak />
お気軽にお問い合わせください

<ParagraphBreak />

電話: 000-0000-0000<br />
メール: info@example.com
```

### 複雑なレイアウト例
```mdx
# レポート

## 概要
このレポートでは...

<Spacer height="30px" />

## データ分析

### 結果1
データ1の結果  
非常に興味深い結果が得られました

<LineBreak count={2} />

### 結果2  
データ2の結果[br]
こちらも重要な発見です

<ParagraphBreak />

## 結論

以上の結果から...
```

これで、MDXコンテンツでの改行が自然で直感的に動作するようになります！
