# Contentful設計書

## 1. 概要

本設計書は、ビジネススキル百科サイトのContentfulコンテンツモデルの設計を定義するものです。このコンテンツモデルは、記事、動画、音声などの異なるコンテンツタイプを管理し、MDXレンダリングシステムと連携して効率的なコンテンツ管理を実現します。

## 2. コンテンツタイプ

### 2.1 Content（コンテンツ）

記事、動画、音声などのコンテンツを管理するためのコンテンツタイプです。

#### 2.1.1 フィールド

| フィールド名 | タイプ | 必須 | 説明 |
|------------|------|------|------|
| title | Short text | ✓ | コンテンツのタイトル |
| slug | Short text | ✓ | URLに使用されるスラッグ（一意である必要あり） |
| contentType | Short text (List) | ✓ | コンテンツの種類（'記事', '動画', '音声'） |
| description | Long text | - | コンテンツの簡単な説明 |
| category | Reference (多数) | ✓ | コンテンツのカテゴリ |
| author | Reference (多数) | - | コンテンツの著者 |
| tags | Reference (多数) | - | コンテンツに関連するタグ |
| body | Rich text | - | コンテンツの本文（リッチテキスト形式） |
| mdxContent | Long text | - | MDX形式のコンテンツ |
| videoUrl | Short text | - | 動画のURL（動画コンテンツの場合） |
| audioUrl | Short text | - | 音声のURL（音声コンテンツの場合） |
| featuredImage | Media | - | コンテンツのメイン画像 |
| thumbnail | Media | - | コンテンツのサムネイル画像 |
| publishDate | Date & time | - | コンテンツの公開日 |
| displayOrder | Number | - | ホームページでの表示順序（0001-9999、シリーズのグループ化に使用） |
| relatedContents | Reference (多数) | - | 関連するコンテンツへの参照 |
| advertisements | Reference (多数) | - | 記事内に表示する広告への参照 |

#### 2.1.2 バリデーション

- **slug**: 一意であること、小文字英数字とハイフンのみ許可
- **contentType**: '記事', '動画', '音声'のいずれかであること
- **videoUrl**: contentTypeが'動画'の場合は必須
- **audioUrl**: contentTypeが'音声'の場合は必須
- **displayOrder**: 1-9999の範囲の整数（シリーズのグループ化に使用、例：100,101,102...）

### 2.2 Category（カテゴリ）

コンテンツのカテゴリを管理するためのコンテンツタイプです。

#### 2.2.1 フィールド

| フィールド名 | タイプ | 必須 | 説明 |
|------------|------|------|------|
| name | Short text | ✓ | カテゴリ名 |
| slug | Short text | ✓ | URLに使用されるスラッグ（一意である必要あり） |
| description | Long text | - | カテゴリの説明 |

#### 2.2.2 バリデーション

- **slug**: 一意であること、小文字英数字とハイフンのみ許可

### 2.3 Tag（タグ）

コンテンツのタグを管理するためのコンテンツタイプです。

#### 2.3.1 フィールド

| フィールド名 | タイプ | 必須 | 説明 |
|------------|------|------|------|
| name | Short text | ✓ | タグ名 |
| slug | Short text | ✓ | URLに使用されるスラッグ（一意である必要あり） |

#### 2.3.2 バリデーション

- **slug**: 一意であること、小文字英数字とハイフンのみ許可

### 2.4 Author（著者）

コンテンツの著者を管理するためのコンテンツタイプです。

#### 2.4.1 フィールド

| フィールド名 | タイプ | 必須 | 説明 |
|------------|------|------|------|
| name | Short text | ✓ | 著者名 |
| bio | Long text | - | 著者の略歴 |
| profilePicture | Media | - | 著者のプロフィール画像 |

### 2.5 Advertisement（広告）

サイト内に表示する広告を管理するためのコンテンツタイプです。

#### 2.5.1 フィールド

| フィールド名 | タイプ | 必須 | 説明 |
|------------|------|------|------|
| title | Short text | ✓ | 広告のタイトル |
| adId | Short text | ✓ | 広告の一意のID（MDXコンテンツから参照するため） |
| description | Long text | - | 広告の説明 |
| image | Media | - | 広告の画像 |
| linkUrl | Short text | - | 広告のリンク先URL |
| adCode | Long text | - | 広告のHTMLコード（外部広告サービスを使用する場合） |
| position | Short text (List) | ✓ | 広告の表示位置（'inline', 'sidebar', 'footer'） |
| startDate | Date & time | - | 広告の表示開始日時 |
| endDate | Date & time | - | 広告の表示終了日時 |
| isActive | Boolean | ✓ | 広告の有効/無効状態 |

#### 2.5.2 バリデーション

- **adId**: 一意であること、小文字英数字とハイフンのみ許可
- **position**: 'inline', 'sidebar', 'footer'のいずれかであること

## 3. コンテンツモデルの関連性

### 3.1 Content - Category

- 多対多の関係
- 1つのコンテンツは複数のカテゴリに属することができる
- 1つのカテゴリは複数のコンテンツを持つことができる

### 3.2 Content - Tag

- 多対多の関係
- 1つのコンテンツは複数のタグを持つことができる
- 1つのタグは複数のコンテンツに関連付けることができる

### 3.3 Content - Author

- 多対多の関係
- 1つのコンテンツは複数の著者を持つことができる
- 1人の著者は複数のコンテンツを作成することができる

### 3.4 Content - Content (relatedContents)

- 多対多の関係
- 1つのコンテンツは複数の関連コンテンツを持つことができる
- 関連付けは双方向ではない（片方向の参照）

### 3.5 Content - Advertisement

- 多対多の関係
- 1つのコンテンツは複数の広告を持つことができる
- 1つの広告は複数のコンテンツに関連付けることができる

## 4. MDXコンテンツの管理

### 4.1 mdxContentフィールドの使用方法

mdxContentフィールドには、MDX形式のコンテンツを直接入力します。このフィールドには以下の要素を含めることができます：

- Markdownの標準的な記法（見出し、リスト、リンクなど）
- JSXコンポーネント（Callout、CodeBlockなど）
- フロントマター（YAMLフォーマット）

### 4.2 MDXコンポーネントの使用例

#### 4.2.1 Calloutコンポーネント

```mdx
<Callout type="info" title="情報">
これは情報を表示するCalloutコンポーネントです。
</Callout>
```

#### 4.2.2 CodeBlockコンポーネント

```mdx
<CodeBlock language="javascript">
function hello() {
  console.log('Hello, world!');
}
</CodeBlock>
```

#### 4.2.3 AdPlacementコンポーネント

```mdx
<!-- 広告IDを指定して特定の広告を表示 -->
<AdPlacement id="demo-ad-1" position="inline" />

<!-- 広告IDを指定せずにランダムな広告を表示 -->
<AdPlacement position="inline" />
```

### 4.3 関連コンテンツの設定

relatedContentsフィールドを使用して、コンテンツ間の関連性を設定します。例えば：

- 動画コンテンツに関連する解説記事
- 音声コンテンツに関連する補足資料
- 記事コンテンツに関連する動画や音声

### 4.4 広告の設定

advertisementsフィールドを使用して、コンテンツに表示する広告を設定します。また、MDXコンテンツ内で`<AdPlacement />`コンポーネントを使用して、特定の位置に広告を挿入することもできます。

#### 4.4.1 広告の表示方法

1. **コンテンツに関連付けられた広告**:
   - コンテンツのadvertisementsフィールドに広告を関連付ける
   - 関連付けられた広告は、サイドバーやフッターに自動的に表示される

2. **MDXコンテンツ内の広告**:
   - MDXコンテンツ内で`<AdPlacement />`コンポーネントを使用
   - 広告IDを指定して特定の広告を表示することも、ランダムな広告を表示することも可能

#### 4.4.2 広告の表示位置

- **inline**: MDXコンテンツ内の任意の位置に表示
- **sidebar**: 右サイドバーに表示（PCのみ）
- **footer**: 記事の最後に表示

## 5. コンテンツ作成ガイドライン

### 5.1 スラッグの命名規則

- 小文字の英数字とハイフンのみを使用
- スペースの代わりにハイフンを使用
- 日本語の場合はローマ字に変換（例：「ロジカルシンキング」→「logical-thinking」）

### 5.2 MDXコンテンツの作成

- 見出しは階層構造を守る（h1 → h2 → h3）
- コードブロックには言語を指定する
- 画像にはalt属性を設定する
- コンポーネントは適切なプロパティを設定する

### 5.3 関連コンテンツの選定

- コンテンツの内容に直接関連するものを選択
- 異なるコンテンツタイプを組み合わせる（記事+動画+音声）
- 関連コンテンツは3〜5個程度に抑える

## 6. コンテンツ管理ワークフロー

### 6.1 コンテンツ作成フロー

1. コンテンツの基本情報を入力（タイトル、スラッグ、説明など）
2. カテゴリ、タグ、著者を設定
3. MDXコンテンツを作成
4. メディア（動画URL、音声URL、画像）を設定
5. 関連コンテンツを選択
6. 公開日を設定
7. 公開

### 6.2 コンテンツ更新フロー

1. 既存のコンテンツを選択
2. 必要な情報を更新
3. 変更を保存
4. 再公開

## 7. プレビュー設定

### 7.1 プレビューの設定方法

1. Contentfulの「Settings」→「Content preview」を開く
2. 新しいプレビュー設定を追加
3. 名前を「Development」に設定
4. URLを「https://skillpedia.jp/api/preview?secret={SECRET}&slug={entry.fields.slug}&contentType={entry.fields.contentType[0]}」に設定
5. 「Save」をクリック

### 7.2 プレビューの使用方法

1. コンテンツの編集画面で「Preview」ボタンをクリック
2. 「Development」を選択
3. プレビューページが新しいタブで開く
